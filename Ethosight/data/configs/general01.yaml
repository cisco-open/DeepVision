################# basic app configuration
analyzeImageMethod: analyzeImage_precompiled
embeddings_path: general.embeddings
labels_path: general.labels
output_type: affinityScores
reasoner_type: chatgpt

################## configure the label space optimization
label_space_optimization:
  enabled: true
  rerun: false # if true, will rerun the optimization even if a results file exists,
                # otherwise will just load the most recent results file
#  method: "semantic_relations"
  method: "semantic_similarity"
  parameters:
    threshold: .8
    max_labels: 10 # this is the max per ground truth label (not total) 

general_templates:
  enabled: false
  template_path: "../templates/general_templates.txt"

################## configure the benchmark
benchmark:
  enabled: true
  batch_mode: true
  batchsize: 256
  image_dir: "/home/hmlatapie/devactive/home/Ethosight/images/robbery"
  # normallabel used to compute benchmark anomaly metrics
  normallabel: "normal event"
# ground_truth_path can be a .txt file or a .csv
# .txt : labels only
# .csv : filename, label pairs ... first row in file is assumed to be a header and is ignored
#  ground_truth_path: "../images/robbery/image-labels2.csv" #only one label per video
  ground_truth_path: "/home/hmlatapie/devactive/home/Ethosight/images/robbery/image-labels.csv"  #labeled correctly per frame

  #normally ground_truth_path .csv contains all the labels so that is all you need
  #however, if ground_truth_labels_path is specified, it will be used to generate 
  #   the ground truth labels and embeddings files
  #if not set and the system needs to generate, the csv will be used
  #as long as your .csv has all the labels, you don't need to set this
  ground_truth_labels_path: "../datasets/ucf-crime/ucf-crime.txt"
  top_n: 5
  bootstrapMode: true # if true, EthosightApp.optimize will start with GT labels
  save_affinities: true # if true, will save the affinity scores to a file

  extracted_video_dir: "../extracted_videos"
  verbose: false
  skip_pre_optimization: true


################## configure the mapper
mapper:
  enabled: true
  # affinity_minthreshold is the minimum affinity score to consider a label
  #  if the affinity score is below the threshold, the label is set to 
  #   normallabel
  affinity_minthreshold:
    enabled: false
    threshold: 26
    normallabel: "normal event"
  threshold: 26 #is this needed for video?
  # modes: 
  #   - passthrough - pass input affinity scores through to output
  #   - labelToLabelAffinity01 - uses affinity between expanded labels and ground truth labels
  #   - compositeLabels01 - create composite labels from input affinity scores, no reasoning
  #   - reasoning01 - create composite labels from input affinity scores, with reasoning 
  #  mode: 'passthrough'
  #mode: 'labelToLabelAffinity01'
  #mode: 'gpt4mode' #uses gpt4 to generate labels... input is the single top label
#  mode: 'gpt4mode2' #uses gpt4 to generate labels, input is the top n affinity scores
  #submode: normallabelonly #only remap the normal label 
  mode: 'hardmap01'
  hardmapfile: '../datasets/ucf-crime/ucf-crime-hardmap.txt'
#  prompt: "Return a label we will use to help analyze an image. The context is to identify crime behavior versus normal behavior. The camera angles may be overhead or normal more horizontal security camera angles. Please analyze the following input label and return 'normal event' or 'crime event' <<{label}>> please return only 'normal event' or 'crime event' as the label with no extra text or delimiters of any kind."
  prompt_1: >
    Please analyze this input label <<{label}>> and return 'normal event' or one of
    the
    following potential labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism'. please return only 'normal event' or  one of these crime
    event labels as the label with no  extra text or  delimiters of any kind. if unsure,
    return the nearest applicable label erring on
    the side of potential health, safety, and security labels.

# SOA anomaly and 20% top1
  prompt: >
    Please analyze the following aggregated and ranked affinity scores from video
    footage  and return 'normal event' or one of the
    following labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism' that best characterizes the most important
    event in the scene.  please return only 'normal event' or  one of these listed
    labels as the label with no  extra text or  delimiters of any kind. if unsure,
    return the nearest applicable label erring on
    the side of potential health, safety, and security labels from our list  ('abuse',
    'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism', 'normal event'). here are the affinity
    scores <<{affinityScores}>>. Just do your best. No extraneous characters.  

# approaching 20% top 1, recall etc... good
  prompt_20230814_000118: >
    Please analyze the following aggregated and ranked affinity scores from  security
    camera video footage and return 'normal event' or one of the
    following labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism' that best characterizes the most important
    event in the scene.  please return only 'normal event' or  one of these listed
    labels as the label with no  extra text or  delimiters of any kind. if unsure,
    return the nearest applicable label erring on
    the side of potential health, safety, and security labels from our list  ('abuse',
    'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism', 'normal event'). here are the affinity
    scores <<{affinityScores}>>. Just do your best. No extraneous characters.  

# SOA anomaly and 20% top1
  prompt_20230813_233003: >
    Please analyze the following aggregated and ranked affinity scores from video
    footage  and return 'normal event' or one of the
    following labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism' that best characterizes the most important
    event in the scene.  please return only 'normal event' or  one of these listed
    labels as the label with no  extra text or  delimiters of any kind. if unsure,
    return the nearest applicable label erring on
    the side of potential health, safety, and security labels from our list  ('abuse',
    'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism', 'normal event'). here are the affinity
    scores <<{affinityScores}>>. Just do your best. No extraneous characters.  

# best result so far... SOTA anomaly metrics
  prompt_20230813_231755: >
    Please analyze the following affinity scores and return 'normal event' or one
    of the
    following labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism' that best characterizes the scene.  please return only
    'normal event' or  one of these listed labels as the label with no  extra text
    or  delimiters of any kind. if unsure, return the nearest applicable label erring
    on
    the side of potential health, safety, and security labels from our list  ('abuse',
    'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism', 'normal event'). here are the affinity
    scores <<{affinityScores}>>. Just do your best. No extraneous characters.  

# this is a gpt4mode2 prompt with affinity scores
  prompt_20230813_225106: >
    Please analyze this input label <<{label}>> and return 'normal event' or one of
    the
    following potential labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism'. please return only 'normal event' or  one of these listed
    labels as the label with no  extra text or  delimiters of any kind. if unsure,
    return the nearest applicable label erring on
    the side of potential health, safety, and security labels from our list. here
    are some
    affinity scores you may take into consideration when selecting the
    best label from our list: <<{affinityScores}>>. Just do your best. No extraneous
    characters.
    one of the labels from our list or 'normal event' only. thank you.

#671 Anomaly Detection Metrics:
#672 Accuracy: 0.7186
#673 Precision: 0.9500
#674 Recall: 0.7355
#675 F1 Score: 0.8291
#676 Top-1 Accuracy: 0.1617
#677 Top-5 Accuracy: 0.3234
#678 Total predictions: 167
  prompt_20230813_2152: >
    Please analyze this input label <<{label}>> and return 'normal event' or one of
    the
    following potential labels: 'abuse', 'arrest', 'arson', 'assault',
    'burglary', 'explosion', 'fighting', 'road accidents', 'robbery', 'shooting',  'shoplifting',
    'stealing', 'vandalism'. please return only 'normal event' or  one of these crime
    event labels as the label with no  extra text or  delimiters of any kind. if unsure,
    return the nearest applicable label.
  prompt2: >
    Return a label we will use to help analyze an image.  The context is to identify
    crime behavior versus normal behavior.  The camera angles may be overhead or normal
    more horizontal security camera angles.  Please analyze the following input label
    and return 'normal event' or 'crime event'  <<{label}>> please return only 'normal
    event' or 'crime event' as the label with no  extra text or delimiters of any
    kind.
  verbose: true


################# configure video
video:
  skip_frames: 0
  normal_label_name: "normal event"
  label_mapping: "periods_count"
  # modes: 
  #   - majority - rank the labels by the number of frames
  #   - longest_period - rank the labels by the number of consecutive frames
  #   - periods_count - rank the labels by the number of periods

################ visualization
visualization:
  top_n_affinity: 100
  show_distinct: true

################# phase2
phase2:
  maxiterations: 200
